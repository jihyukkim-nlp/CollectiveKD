# https://github.com/castorini/anserini/blob/master/docs/experiments-msmarco-passage.md
# https://github.com/castorini/docTTTTTquery

scp jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/DataCenter/MSMARCO/docT5query/run.msmarco-passage-expanded.trec2019.pass.txt experiments/pilot_test/fb_bm25/trec2019/docT5query.trec2019.tsv
scp jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/DataCenter/MSMARCO/docT5query/run.msmarco-passage-expanded.trec2020.pass.txt experiments/pilot_test/fb_bm25/trec2020/docT5query.trec2020.tsv

sh /workspace/GitHubCodes/anserini/target/appassembler/bin/SearchMsmarco -index lucene-index-msmarco-passage-expanded -queries ../trec_passages/trec2019/queries.trec2019-pass.tsv -output run.msmarco-passage-expanded.trec2019.pass.txt -hits 1000 -threads 8
sh /workspace/GitHubCodes/anserini/target/appassembler/bin/SearchMsmarco -index lucene-index-msmarco-passage-expanded -queries ../trec_passages/trec2020/queries.trec2020-pass.tsv -output run.msmarco-passage-expanded.trec2020.pass.txt -hits 1000 -threads 8

python trec_eval.py --qrels ../trec_passages/trec2019/2019qrels-pass.txt --ranking run.msmarco-passage-expanded.trec2019.pass.txt
{'nDCG@10': 0.6471261219318702, 'nDCG@25': 0.6122667846885703, 'nDCG@50': 0.5927785612470575, 'nDCG@100': 0.5936563292107051, 'nDCG@200': 0.6354147222139802, 'nDCG@500': 0.6752625030856977, 'nDCG@1000': 0.6946573741563871, 'R(rel=2)@3': 0.09943844318479639, 'R(rel=2)@5': 0.1612508073325649, 'R(rel=2)@10': 0.2476654538839286, 'R(rel=2)@25': 0.3879693431590354, 'R(rel=2)@50': 0.48439790019026707, 'R(rel=2)@100': 0.5911870578959582, 'R(rel=2)@200': 0.7079870135304499, 'R(rel=2)@1000': 0.829154262530071, 'P(rel=2)@1': 0.7209302325581395, 'P(rel=2)@3': 0.6511627906976745, 'P(rel=2)@5': 0.6511627906976745, 'P(rel=2)@10': 0.5860465116279069, 'P(rel=2)@25': 0.4297674418604652, 'P(rel=2)@50': 0.3153488372093023, 'P(rel=2)@100': 0.23209302325581396, 'P(rel=2)@200': 0.17488372093023255, 'P(rel=2)@1000': 0.04597674418604649, 'AP(rel=2)@1000': 0.4059378329379299, 'RR(rel=2)@10': 0.8180878552971578, 'NumRet': 43000.0, 'num_q': 43.0}

python trec_eval.py --qrels ../trec_passages/trec2020/2020qrels-pass.txt --ranking run.msmarco-passage-expanded.trec2020.pass.txt
{'nDCG@10': 0.6226558381585657, 'nDCG@25': 0.5971317414203887, 'nDCG@50': 0.5966321060825257, 'nDCG@100': 0.6103181068362438, 'nDCG@200': 0.6404776413535825, 'nDCG@500': 0.6690727965676696, 'nDCG@1000': 0.6857299223065438, 'R(rel=2)@3': 0.1368574603872559, 'R(rel=2)@5': 0.20924898408725617, 'R(rel=2)@10': 0.34459532023232575, 'R(rel=2)@25': 0.48774611569763354, 'R(rel=2)@50': 0.6095012347533207, 'R(rel=2)@100': 0.7053070137698634, 'R(rel=2)@200': 0.7660050114869625, 'R(rel=2)@1000': 0.8433745627176584, 'P(rel=2)@1': 0.6296296296296297, 'P(rel=2)@3': 0.5740740740740743, 'P(rel=2)@5': 0.5555555555555556, 'P(rel=2)@10': 0.4796296296296297, 'P(rel=2)@25': 0.3303703703703703, 'P(rel=2)@50': 0.2233333333333333, 'P(rel=2)@100': 0.14851851851851847, 'P(rel=2)@200': 0.08703703703703704, 'P(rel=2)@1000': 0.02179629629629631, 'AP(rel=2)@1000': 0.40949262880681736, 'RR(rel=2)@10': 0.753858024691358, 'NumRet': 54000.0, 'num_q': 54.0}


python -m scripts.label.pilot_test.fb_bm25.tsv_to_jsonl --tsv experiments/pilot_test/fb_bm25/trec2019/docT5query.trec2019.tsv --output experiments/pilot_test/fb_bm25/trec2019/docT5query.trec2019.jsonl
python -m scripts.label.pilot_test.fb_bm25.tsv_to_jsonl --tsv experiments/pilot_test/fb_bm25/trec2020/docT5query.trec2020.tsv --output experiments/pilot_test/fb_bm25/trec2020/docT5query.trec2020.jsonl

# Pilot test on TREC-DL 2019
sh scripts/label/pilot_test/fb_bm25/trec2019.prf.fb_bm25.sh 0 3 10 0.5 24
# ranking result: experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta0.5.clusters24/label.py/2021-11-05_02.47.58/ranking.tsv
#* {'nDCG@10': 0.7499298775540899, 'nDCG@25': 0.7161047380317864, 'nDCG@50': 0.6961947902802632, 'nDCG@100': 0.6845909667460557, 'nDCG@200': 0.6944938290808806, 'nDCG@500': 0.7179404322752289, 'nDCG@1000': 0.727107434675859, 'R(rel=2)@3': 0.13058248179865975, 'R(rel=2)@5': 0.18731062030468773, 'R(rel=2)@10': 0.30728196885289805, 'R(rel=2)@25': 0.46500836962934394, 'R(rel=2)@50': 0.572616248880696, 'R(rel=2)@100': 0.6656937671398719, 'R(rel=2)@200': 0.7514044508477238, 'R(rel=2)@1000': 0.8287160609184753, 'P(rel=2)@1': 0.7906976744186046, 'P(rel=2)@3': 0.7829457364341086, 'P(rel=2)@5': 0.7395348837209301, 'P(rel=2)@10': 0.6767441860465115, 'P(rel=2)@25': 0.5293023255813954, 'P(rel=2)@50': 0.3967441860465117, 'P(rel=2)@100': 0.28395348837209294, 'P(rel=2)@200': 0.18720930232558133, 'P(rel=2)@1000': 0.04302325581395347, 'AP(rel=2)@1000': 0.5193512192963524, 'RR(rel=2)@10': 0.8740310077519381, 'NumRet': 43000.0, 'num_q': 43.0}
sh scripts/label/pilot_test/fb_bm25/trec2019.prf.fb_bm25.sh 0 3 10 1.0 24
# ranking result: experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta1.0.clusters24/label.py/2021-11-05_03.21.59/ranking.tsv
#* {'nDCG@10': 0.7207118248605747, 'nDCG@25': 0.6939030056965461, 'nDCG@50': 0.6796624486783117, 'nDCG@100': 0.6692503183120045, 'nDCG@200': 0.680003985080787, 'nDCG@500': 0.7075620466677686, 'nDCG@1000': 0.715841964898986, 'R(rel=2)@3': 0.1286832569924582, 'R(rel=2)@5': 0.17182392856999446, 'R(rel=2)@10': 0.2873143792475185, 'R(rel=2)@25': 0.44922236344342026, 'R(rel=2)@50': 0.5661801728281298, 'R(rel=2)@100': 0.6587299250250933, 'R(rel=2)@200': 0.74388167302101, 'R(rel=2)@1000': 0.8267392191882272, 'P(rel=2)@1': 0.7674418604651163, 'P(rel=2)@3': 0.7674418604651164, 'P(rel=2)@5': 0.6930232558139533, 'P(rel=2)@10': 0.6465116279069766, 'P(rel=2)@25': 0.5172093023255815, 'P(rel=2)@50': 0.393953488372093, 'P(rel=2)@100': 0.28093023255813954, 'P(rel=2)@200': 0.1858139534883721, 'P(rel=2)@1000': 0.042976744186046495, 'AP(rel=2)@1000': 0.49769181141113095, 'RR(rel=2)@10': 0.8582041343669251, 'NumRet': 43000.0, 'num_q': 43.0}
sh scripts/label/pilot_test/fb_bm25/trec2019.prf.fb_bm25.sh 0 1 10 0.5 10
# ranking result: experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs1.k10.beta0.5.clusters10/label.py/2021-11-07_19.50.42/ranking.tsv
#* {'nDCG@10': 0.7248732641531628, 'nDCG@25': 0.702654617610427, 'nDCG@50': 0.6814587739188417, 'nDCG@100': 0.6688069700500907, 'nDCG@200': 0.6815354370546601, 'nDCG@500': 0.7058989581055485, 'nDCG@1000': 0.7149544256000085, 'R(rel=2)@3': 0.12295554297946679, 'R(rel=2)@5': 0.1818977649052595, 'R(rel=2)@10': 0.28825157599580964, 'R(rel=2)@25': 0.4501496632979157, 'R(rel=2)@50': 0.56256878731012, 'R(rel=2)@100': 0.6650160502167393, 'R(rel=2)@200': 0.7586835608717873, 'R(rel=2)@1000': 0.8271267388426072, 'P(rel=2)@1': 0.813953488372093, 'P(rel=2)@3': 0.7441860465116279, 'P(rel=2)@5': 0.7069767441860466, 'P(rel=2)@10': 0.6581395348837212, 'P(rel=2)@25': 0.5227906976744187, 'P(rel=2)@50': 0.39069767441860465, 'P(rel=2)@100': 0.2802325581395349, 'P(rel=2)@200': 0.18406976744186043, 'P(rel=2)@1000': 0.04283720930232557, 'AP(rel=2)@1000': 0.49098426771982806, 'RR(rel=2)@10': 0.8856589147286822, 'NumRet': 43000.0, 'num_q': 43.0}
sh scripts/label/pilot_test/fb_bm25/trec2019.prf.fb_bm25.sh 0 1 10 1.0 10
# ranking result: experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs1.k10.beta1.0.clusters10/label.py/2021-11-07_20.15.27/ranking.tsv
#* {'nDCG@10': 0.6942515642226628, 'nDCG@25': 0.6797339640291866, 'nDCG@50': 0.6646410647569112, 'nDCG@100': 0.6537534243829861, 'nDCG@200': 0.6671395227898396, 'nDCG@500': 0.6933845075095495, 'nDCG@1000': 0.7027978767097657, 'R(rel=2)@3': 0.11500112169093121, 'R(rel=2)@5': 0.17387445182142286, 'R(rel=2)@10': 0.269213210231821, 'R(rel=2)@25': 0.4439599326702025, 'R(rel=2)@50': 0.5625150788058946, 'R(rel=2)@100': 0.6651449762924323, 'R(rel=2)@200': 0.7532780229664976, 'R(rel=2)@1000': 0.8274992258823163, 'P(rel=2)@1': 0.7209302325581395, 'P(rel=2)@3': 0.7286821705426357, 'P(rel=2)@5': 0.702325581395349, 'P(rel=2)@10': 0.6348837209302326, 'P(rel=2)@25': 0.5153488372093024, 'P(rel=2)@50': 0.39348837209302323, 'P(rel=2)@100': 0.28116279069767447, 'P(rel=2)@200': 0.1847674418604651, 'P(rel=2)@1000': 0.04283720930232557, 'AP(rel=2)@1000': 0.4781059670515211, 'RR(rel=2)@10': 0.829263565891473, 'NumRet': 43000.0, 'num_q': 43.0}



# Pilot test on TREC-DL 2020
sh scripts/label/pilot_test/fb_bm25/trec2020.prf.fb_bm25.sh 0 3 10 0.5 24
# ranking result: experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta0.5.clusters24/label.py/2021-11-05_04.00.02/ranking.tsv
#* {'nDCG@10': 0.7143217834958663, 'nDCG@25': 0.6710491158642045, 'nDCG@50': 0.6574003919278679, 'nDCG@100': 0.6603080817198829, 'nDCG@200': 0.6809886728578028, 'nDCG@500': 0.704690587518724, 'nDCG@1000': 0.7128823667835437, 'R(rel=2)@3': 0.16219987231208802, 'R(rel=2)@5': 0.2788205957591118, 'R(rel=2)@10': 0.3936454405929331, 'R(rel=2)@25': 0.5535927287458687, 'R(rel=2)@50': 0.6549083439586871, 'R(rel=2)@100': 0.7515129872142341, 'R(rel=2)@200': 0.7971908280777683, 'R(rel=2)@1000': 0.8470493803792577, 'P(rel=2)@1': 0.7592592592592593, 'P(rel=2)@3': 0.7037037037037034, 'P(rel=2)@5': 0.6814814814814816, 'P(rel=2)@10': 0.561111111111111, 'P(rel=2)@25': 0.374074074074074, 'P(rel=2)@50': 0.2611111111111111, 'P(rel=2)@100': 0.16574074074074072, 'P(rel=2)@200': 0.09277777777777778, 'P(rel=2)@1000': 0.021037037037037045, 'AP(rel=2)@1000': 0.48551608842808264, 'RR(rel=2)@10': 0.8412257495590829, 'NumRet': 54000.0, 'num_q': 54.0}
sh scripts/label/pilot_test/fb_bm25/trec2020.prf.fb_bm25.sh 0 3 10 1.0 24
# ranking result: experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta1.0.clusters24/label.py/2021-11-05_04.51.12/ranking.tsv
#* {'nDCG@10': 0.6948483672295324, 'nDCG@25': 0.6513205207286128, 'nDCG@50': 0.6385349170940494, 'nDCG@100': 0.6411867957435261, 'nDCG@200': 0.6653074060601818, 'nDCG@500': 0.6904451590423245, 'nDCG@1000': 0.6994749043939502, 'R(rel=2)@3': 0.1560167732737398, 'R(rel=2)@5': 0.26175624881992954, 'R(rel=2)@10': 0.3923477092656577, 'R(rel=2)@25': 0.5397921113288819, 'R(rel=2)@50': 0.6498035998368864, 'R(rel=2)@100': 0.7325783881902774, 'R(rel=2)@200': 0.788821539010132, 'R(rel=2)@1000': 0.847791792636417, 'P(rel=2)@1': 0.6666666666666666, 'P(rel=2)@3': 0.6975308641975309, 'P(rel=2)@5': 0.6592592592592594, 'P(rel=2)@10': 0.5537037037037036, 'P(rel=2)@25': 0.36296296296296293, 'P(rel=2)@50': 0.25703703703703706, 'P(rel=2)@100': 0.1622222222222222, 'P(rel=2)@200': 0.09259259259259262, 'P(rel=2)@1000': 0.021018518518518527, 'AP(rel=2)@1000': 0.46125859989221063, 'RR(rel=2)@10': 0.7870370370370371, 'NumRet': 54000.0, 'num_q': 54.0}
sh scripts/label/pilot_test/fb_bm25/trec2020.prf.fb_bm25.sh 0 1 10 0.5 10
# ranking result: experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs1.k10.beta0.5.clusters10/label.py/2021-11-07_20.42.32/ranking.tsv
#* {'nDCG@10': 0.6810724615487479, 'nDCG@25': 0.6571738288972396, 'nDCG@50': 0.6442379940606777, 'nDCG@100': 0.6457556817109947, 'nDCG@200': 0.6648858140234603, 'nDCG@500': 0.6883772821893103, 'nDCG@1000': 0.6991371130068011, 'R(rel=2)@3': 0.15968403499294268, 'R(rel=2)@5': 0.26846982698784444, 'R(rel=2)@10': 0.3836818260379076, 'R(rel=2)@25': 0.5634743703478695, 'R(rel=2)@50': 0.6628707237884918, 'R(rel=2)@100': 0.740641417585591, 'R(rel=2)@200': 0.791670176847015, 'R(rel=2)@1000': 0.8441678789577145, 'P(rel=2)@1': 0.6296296296296297, 'P(rel=2)@3': 0.6728395061728394, 'P(rel=2)@5': 0.6703703703703703, 'P(rel=2)@10': 0.5370370370370369, 'P(rel=2)@25': 0.37999999999999995, 'P(rel=2)@50': 0.2633333333333333, 'P(rel=2)@100': 0.1627777777777778, 'P(rel=2)@200': 0.0915740740740741, 'P(rel=2)@1000': 0.020833333333333343, 'AP(rel=2)@1000': 0.47168227165106047, 'RR(rel=2)@10': 0.7743827160493828, 'NumRet': 54000.0, 'num_q': 54.0}
sh scripts/label/pilot_test/fb_bm25/trec2020.prf.fb_bm25.sh 0 1 10 1.0 10
# ranking result: experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs1.k10.beta1.0.clusters10/label.py/2021-11-07_21.19.35/ranking.tsv
#* {'nDCG@10': 0.673435657908828, 'nDCG@25': 0.6422056514504185, 'nDCG@50': 0.6361769059454921, 'nDCG@100': 0.6343654407827842, 'nDCG@200': 0.6534380047118136, 'nDCG@500': 0.6795563849871742, 'nDCG@1000': 0.690861877538559, 'R(rel=2)@3': 0.1531837837853956, 'R(rel=2)@5': 0.25162836889265466, 'R(rel=2)@10': 0.3771611189114733, 'R(rel=2)@25': 0.5323462992116057, 'R(rel=2)@50': 0.652913971814638, 'R(rel=2)@100': 0.7273401633863236, 'R(rel=2)@200': 0.7801100271988014, 'R(rel=2)@1000': 0.8405036418802403, 'P(rel=2)@1': 0.6296296296296297, 'P(rel=2)@3': 0.6419753086419753, 'P(rel=2)@5': 0.6333333333333331, 'P(rel=2)@10': 0.5425925925925925, 'P(rel=2)@25': 0.3659259259259258, 'P(rel=2)@50': 0.2596296296296296, 'P(rel=2)@100': 0.16074074074074074, 'P(rel=2)@200': 0.08953703703703704, 'P(rel=2)@1000': 0.02081481481481482, 'AP(rel=2)@1000': 0.4563930508771226, 'RR(rel=2)@10': 0.7592592592592593, 'NumRet': 54000.0, 'num_q': 54.0}





scp -r experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta0.5.clusters24 jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/Research/PassageRetrieval/qe_pseudo_labeling/experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta0.5.clusters24
scp -r experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta1.0.clusters24 jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/Research/PassageRetrieval/qe_pseudo_labeling/experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta1.0.clusters24
scp -r experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta0.5.clusters24 jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/Research/PassageRetrieval/qe_pseudo_labeling/experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta0.5.clusters24
scp -r experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta1.0.clusters24 jihyuk@dilab003.yonsei.ac.kr:/hdd/jihyuk/Research/PassageRetrieval/qe_pseudo_labeling/experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta1.0.clusters24

# execute this in dilab003
# source scripts/analysis/score_presumed_hard_negatives.qe.sh ${device} ${trec} ${exp} ${output}
source scripts/analysis/score_presumed_hard_negatives.qe.sh 1 2019 experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta0.5.clusters24 analysis/calibration_on_presumed_negatives/trec2019/score.prf.fb_bm25.docs3.k10.beta0.5.clusters24.tsv
source scripts/analysis/score_presumed_hard_negatives.qe.sh 1 2019 experiments/pilot_test/fb_bm25/trec2019/prf.fb_bm25.docs3.k10.beta1.0.clusters24 analysis/calibration_on_presumed_negatives/trec2019/score.prf.fb_bm25.docs3.k10.beta1.0.clusters24.tsv
source scripts/analysis/score_presumed_hard_negatives.qe.sh 1 2020 experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta0.5.clusters24 analysis/calibration_on_presumed_negatives/trec2020/score.prf.fb_bm25.docs3.k10.beta0.5.clusters24.tsv
source scripts/analysis/score_presumed_hard_negatives.qe.sh 1 2020 experiments/pilot_test/fb_bm25/trec2020/prf.fb_bm25.docs3.k10.beta1.0.clusters24 analysis/calibration_on_presumed_negatives/trec2020/score.prf.fb_bm25.docs3.k10.beta1.0.clusters24.tsv

source scripts/analysis/compare_scores_on_presumed_negatives.sh 2019
source scripts/analysis/compare_scores_on_presumed_negatives.sh 2020